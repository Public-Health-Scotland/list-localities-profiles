---
title: ''
output:
  word_document:
    reference_docx: "/conf/LIST_analytics/West Hub/02 - Scaled Up Work/RMarkdown/Locality
      Profiles/Master RMarkdown Document & Render Code/Locality_Profiles_Report_Template.docx"
  html_document:
    df_print: paged
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE)
options(kableExtra.auto_format = FALSE)

# Line below for testing only
LOCALITY <- "Inverness"
# LOCALITY <- "Stirling City with the Eastern Villages Bridge of Allan and Dunblane"
# LOCALITY <- "Ayr North and Former Coalfield Communities"
# LOCALITY <- "Helensburgh and Lomond"
# LOCALITY <- "City of Dunfermline"
# LOCALITY <- "Skye, Lochalsh and West Ross"
# LOCALITY <- "East Dunbartonshire West"


source("~/localities/Master RMarkdown Document & Render Code/Global Script.R")

source("~/localities//General Health/3. General Health Outputs.R")


x <- 1 # object for figure numbers
y <- 1 # object for table numbers
```

#####Page break

## General Health

###Summary

\newline

**For the most recent time periods available^3^, `r LOCALITY` Locality had:**

```{r echo = FALSE}
life_exp_text <- if (is.na(avg_life_exp_latest_male)) {
  "No data available for life expectancy."
} else {
  paste0("An average life expectancy of **", avg_life_exp_latest_male, "** years for males and **", avg_life_exp_latest_fem, "** years for females, compared to the national average of ", scot_life_exp_male, " and ", scot_life_exp_fem, " years of age respectively.")
}

life_exp_text2 <- if (is.na(avg_life_exp_latest_male)) {
  "No data available for life expectancy at locality level."
} else {
  paste0("In the latest time period available from ", latest_period_life_exp_loc, " (5-year aggregate), the average life expectancy in ", LOCALITY, " locality was ", avg_life_exp_latest_male, " years of age for men, and ", avg_life_exp_latest_fem, " years of age for women. A 10-year time trend can be seen in figure ", x, ".")
}
```

-   `r life_exp_text`
-   A death rate for ages 15 to 44 of **`r format_number_for_text(deaths_15_44_latest)`** deaths per 100,000 age-sex standardised population. This is `r deaths_15_44_diff_scot` than Scotland (`r format_number_for_text(scot_deaths_15_44)` deaths per 100,000)^4^.
-   **`r format_number_for_text(ltc_percent_total_latest)`%** of the locality's population with at least one long-term physical health condition. This is `r ltc_diff_scot` than Scotland (`r format_number_for_text(ltc_perc_scot)`%).
-   A cancer registration rate of **`r format_number_for_text(cancer_reg_rate_latest)`** registrations per 100,000 age-sex standardised population (compared to `r format_number_for_text(scot_cancer)` in Scotland), and an early deaths (\<75 years) from cancer rate of **`r format_number_for_text(early_deaths_cancer_rate_latest)`** per 100,000 age-sex standardised population (compared to `r format_number_for_text(scot_cancer_deaths)` in Scotland)^4^.
-   **`r format_number_for_text(adp_presc_latest)`%** of the population being prescribed medication for anxiety, depression, or psychosis. This is a `r adp_presc_diff_scot` proportion than Scotland (`r format_number_for_text(scot_adp_presc)`%).

\newline

###Life Expectancy

`r life_exp_text2`

####Figure `r x`: Average life expectancy in men and women over time. \newline

```{r echo = FALSE, fig.width = 6, fig.height = 3.5}
if (LOCALITY %in% check_missing_data_scotpho(life_exp)$area_name) {
  print("No data available for this locality")
} else {
  life_exp_trend
}

x <- x + 1
```

#####Page break

Table `r y` provides the average life expectancy for men and women in different areas for the latest time period available.

####Table `r y`: Average life expectancy in years for the latest time periods (`r latest_period_life_exp_loc` aggregated years for the locality; `r latest_period_life_exp_otherareas` aggregated years for other areas).

\newline

```{r echo = FALSE}
knitr::kable(life_exp_table)

y <- y + 1
```

\newline

`r if(HSCP == "Clackmannanshire and Stirling"){"Please note that data was unavailable for Clackmannanshire & Stirling HSCP."}`

\newline

###Deaths, aged 15-44 The following chart shows a trend of death rates among 15-44 year olds per 100,000 age-sex standardised population^4^ by area. In the most recent aggregate time period available (`r latest_period_deaths_15_44`), the mortality rate in `r LOCALITY` locality was **`r format_number_for_text(deaths_15_44_latest)`** deaths per 100,000 population.

####Figure `r x`: Deaths aged 15-44 years by geographical area and over time. \newline

```{r echo = FALSE, fig.width = 7.5, fig.height = 4.2}
deaths_15_44_time_trend

x <- x + 1
```

#####Page break

Figure `r x` provides comparisons of deaths at ages 15-44 across all areas including other localities in `r HSCP` HSCP. In `r latest_period_deaths_15_44`, `r LOCALITY` had a `r deaths_15_44_diff_scot` rate than the rest of Scotland (`r format_number_for_text(deaths_15_44_latest)` compared to `r format_number_for_text(scot_deaths_15_44)` deaths per 100,000).

####Figure `r x`: Deaths at ages 15-44 by area for the latest time period available. \newline

```{r echo = FALSE, fig.width = 7.5, fig.height = 4.8}
deaths_15_44_bar

x <- x + 1
```

#####Page break ###Long-Term Physical Health Conditions and Multimorbidity

\newline

In the financial year `r latest_year_ltc`, in `r LOCALITY` Locality, it is estimated that **`r format_number_for_text(ltc_percent_total_latest)`%** of the population had at least one physical long-term condition (LTC). These include: cardiovascular, neurodegenerative, and respiratory conditions, as well as other organ conditions (namely liver disease and renal failure), arthritis, cancer, diabetes, and epilepsy. *Please note that estimates for this section are based on people who had contact with NHS services - see footnotes for further information and caveats on identifying LTCs.^5^*

```{r echo = FALSE, fig.width = 7.5, fig.height = 3.5}
waffles
```

\newline

The co-occurrence of two or more conditions, known as multimorbidity, is broken down in table `r y`, distinguishing between age groups. Overall, **`r format_number_for_text(ltc_multimorbidity_un65_perc)`**% of those under the age of 65 have more than one LTC, compared to **`r format_number_for_text(ltc_multimorbidity_ov65_perc)`**% of those aged over 65.

####Table `r y`: Multimorbidity of physical long-term conditions by age group in `r latest_year_ltc`. \newline

```{r echo = FALSE}
knitr::kable(ltc_multimorbidity_table)

y <- y + 1
```

#####Page break **Most common physical Long-Term Conditions (LTCs)**

Below is a breakdown of the physical LTCs, for the financial year `r latest_year_ltc`. Figure `r x` shows the prevalence of different LTCs in each age group in `r LOCALITY` locality, and Table `r y` illustrates the top 5 physical LTCs across all ages at locality, partnership, and Scotland level.

####Figure `r x`: Percentage people with each physical LTC, split by age group. \newline

```{r echo = FALSE, fig.width = 7.5, fig.height = 3.8}
ltc_types_plot

x <- x + 1
```

######\*COPD: Chronic Obstructive Pulmonary Disease

####Table `r y`: Prevalence of the five most common physical LTCs as a percentage of the population across geographical areas (where 1 = most prevalent).

\newline

```{r echo = FALSE, fig.width = 7.5, fig.height = 3.5}
top5_ltc_table

y <- y + 1
```

###Cancer For the period `r latest_period_cancer_reg`, there were **`r format_number_for_text(cancer_reg_total_latest)`** new cancer registrations per year on average (**`r format_number_for_text(cancer_reg_rate_latest)`** registrations per 100,000 age-sex standardised population) in `r LOCALITY` locality. For the period `r latest_period_early_deaths_cancer`, there were also **`r format_number_for_text(early_deaths_cancer_rate_latest)`** early deaths per 100,000 from cancer in the locality, this is a **`r format_number_for_text(cancer_deaths_perc_change)`%** `r cancer_deaths_changeword` compared to the rate 10 years prior.

####Figure `r x`: Cancer registration rate over time and by area. \newline

```{r echo = FALSE, fig.width = 7.5, fig.height = 3.7}
cancer_reg_time_trend


x <- x + 1
```

####Figure `r x`: Early deaths from cancer (\<75 years) over time and by area. \newline

```{r echo = FALSE, fig.width = 7.5, fig.height = 3.7}
early_deaths_cancer_time_trend

x <- x + 1
```

#####Page break

### Hospitalisations by condition

Patient hospitalisations can provide some indication of how certain diseases have varying impacts on people's lives. In the latest time period available in `r LOCALITY`, the condition with the highest rate of hospitalisations was `r highest_hosp_disease$indicator`.

#### Table `r y`: Patient hospitalisations by condition and geographical area, age-sex standardised rates per 100,000.

```{r echo = FALSE}
knitr::kable(disease_hosp_table)

y <- y + 1
```

\newline

###Anxiety, Depression, and Psychosis prescriptions

In `r latest_period_adp_presc`, **`r format_number_for_text(adp_presc_latest)`%** of people were prescribed medication for anxiety, depression, or psychosis in `r LOCALITY` Locality. This is a **`r format_number_for_text(adp_presc_perc_change)`% `r adp_presc_changeword`** from the rate 10 years prior in `r prev_period_adp_presc`.

####Figure `r x`: Anxiety, depression, and psychosis prescriptions over time and by geographical area. \newline

```{r echo = FALSE, fig.width = 7.5, fig.height = 3.8}
adp_presc_time_trend

x <- x + 1
```

#####Page break

In `r latest_period_adp_presc`, `r LOCALITY` had a `r adp_presc_diff_scot` proportion of the population being prescribed ADP medication compared to the rest of Scotland (`r format_number_for_text(adp_presc_latest)`% compared to `r format_number_for_text(scot_adp_presc)`%).

####Figure `r x`: Percentage population prescribed medication for anxiety, depression, and psychosis by area for the latest time period available. \newline

```{r echo = FALSE, fig.width = 7.5, fig.height = 4.8}
adp_presc_bar
```
